---
title: "Conversation State Management"
---

# Conversation State Management

- Message data structures
  - Message object schema
  - Required fields (id, role, content, timestamp)
  - Optional metadata fields
  - Attachment handling
  - Status and state fields
- Message parts structure (2024-2025)
  - `message.parts` array format
  - Part types: text, file, tool-invocation, tool-result
  - Reasoning parts for thinking models
  - Source-url and source-document parts
  - Type-safe part handling
- Conversation history storage
  - In-memory storage
  - localStorage for persistence
  - IndexedDB for large histories
  - Server-side storage
- OpenAI Conversations API (2024-2025)
  - Persistent conversation objects
  - Durable conversation IDs
  - `conversation` parameter in Responses API
  - Cross-session, cross-device state
- Automatic context chaining
  - `previous_response_id` parameter
  - Stateless multi-turn conversations
  - No manual message array management
  - Server-side context preservation
- Context window management
  - `/responses/compact` endpoint
  - Encrypted compaction items
  - Token limit handling
  - ZDR-compatible compression
- State updates during streaming
  - Partial message state
  - Real-time content updates
  - Immutable update patterns
  - Avoiding race conditions
- Optimistic updates
  - Immediate UI feedback
  - Rollback on failure
  - Pending state indicators
  - Conflict resolution
- Persistence strategies (localStorage, database)
  - Sync vs async persistence
  - Storage limits handling
  - Encryption for sensitive data
  - Cross-device sync
- Conversation switching
  - Multiple conversation support
  - Conversation list management
  - Active conversation state
  - Lazy loading of histories
