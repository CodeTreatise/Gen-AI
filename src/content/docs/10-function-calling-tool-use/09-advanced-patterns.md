---
title: "Advanced Patterns"
---

# Advanced Patterns

- Tool choice and control modes
  - `auto`: model decides (default)
  - `required`: must call at least one function
  - `none`: disable function calling
  - Forced specific function: `{type: "function", name: "..."}`
  - `allowed_tools`: subset restriction for caching
  - `validated` (preview): guarantees schema adherence
- Dynamic function registration
  - Runtime tool addition
  - Conditional tools based on context
  - User-based tool permissions
  - Context-aware tool sets
- Function composition
  - Combining simple functions
  - Macro functions
  - Workflow functions
  - Abstraction layers
- Nested function calling
  - Functions calling functions
  - Recursive patterns
  - Depth limits
  - Cycle prevention
- Human-in-the-loop confirmation
  - Confirmation workflows for destructive actions
  - Approval gates
  - Preview before execution
  - Modification opportunities
- Function call streaming
  - Streaming function arguments as generated
  - `response.function_call_arguments.delta` events
  - Progressive updates to UI
  - Long-running function support
- Custom tools (OpenAI)
  - Non-JSON schema tools
  - Plain text input instead of structured
  - Arbitrary string responses
  - Use cases: code execution, natural language
- Context-free grammars for tools
  - Lark grammar syntax
  - Regex grammar syntax
  - Constrained model output
  - Grammar validation
  - LLGuidance for sampling constraints
