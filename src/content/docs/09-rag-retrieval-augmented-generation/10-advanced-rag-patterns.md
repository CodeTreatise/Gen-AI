---
title: "Advanced RAG Patterns"
---

# Advanced RAG Patterns

- Agentic RAG (multi-step retrieval)
  - Query decomposition
  - Iterative retrieval
  - Tool-augmented RAG
  - Dynamic query refinement
- LangChain RAG Agents (2025 pattern)
  - Retrieval as a tool with `@tool` decorator:
    - Import `tool` from langchain.tools and `create_agent` from langchain.agents
    - Define retrieval function with `@tool(response_format="content_and_artifact")` decorator
    - Function takes query string parameter with descriptive docstring
    - Perform similarity_search on vector_store with query and k parameter
    - Serialize retrieved docs by joining source metadata and page_content
    - Return tuple of (serialized_content, retrieved_docs) for content + artifacts
    - Create agent with model name, tools list, and system_prompt
    - Agent uses GPT-4.1 or similar model to decide when to invoke retrieval
  - Agent decides when to search (vs. always searching)
  - Multiple searches per query when needed
  - Contextual query generation from conversation
  - Artifacts for accessing document metadata
- RAG Chains (single-pass pattern)
  - Always run search, single LLM call
  - Lower latency but less flexible:
    - Import `dynamic_prompt` from langchain.agents.middleware
    - Define prompt function with `@dynamic_prompt` decorator
    - Extract query from request.state["messages"] (last message text)
    - Perform similarity_search on vector_store with the query
    - Join document page_content with double newlines for context
    - Return formatted prompt string with context and instructions
    - Create agent with model, empty tools list, and middleware containing prompt function
    - Middleware runs before every LLM call, injecting retrieved context automatically
  - Trade-off: speed vs. flexibility
- Self-reflective RAG
  - Answer quality checking
  - Retrieval sufficiency evaluation
  - Retry with refined query
  - Self-correction loops
- Corrective RAG
  - Error detection
  - Correction strategies
  - Confidence thresholds
  - Fallback mechanisms
- Graph RAG (Microsoft pattern)
  - Knowledge graph integration
  - Entity extraction from documents
  - Community detection and summarization
  - Global queries across entire corpus
  - Local queries for specific entities
  - Graph traversal for relationship discovery
  - Structured + unstructured hybrid
- Multi-source RAG
  - Multiple knowledge bases
  - Source routing
  - Cross-source synthesis
  - Source prioritization
- Conversational RAG with memory
  - Conversation history tracking
  - Context accumulation
  - Memory summarization
  - Follow-up question handling
- Deep Research APIs
  - OpenAI Deep Research:
    - Multi-step autonomous research
    - Web browsing and synthesis
    - Comprehensive reports generation
    - Hours of research in minutes
  - Gemini Deep Research:
    - `deep_research` tool in API
    - Agentic research with planning
    - Source synthesis and citation
  - Use cases:
    - Competitive analysis
    - Literature review
    - Market research
    - Due diligence reports
